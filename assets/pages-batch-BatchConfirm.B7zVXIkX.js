import{S as e,r as t,o as a,X as s,N as o,x as l,y as n,z as c,g as u,h as r,q as i,d,k as m,c as f,A as h,F as p,n as _,m as v,Y as I,G as g,t as w,Z as y,v as D}from"./index-BHzFND5V.js";import{_ as C}from"./wd-input-number.Cg3rLShK.js";import{o as k,d as A,e as x,u as b,r as P,f as j}from"./uni-app.es.wfT66NnM.js";import{_ as B}from"./wd-swipe-action.CEelKgkL.js";import{e as F,E as N}from"./eventBus.4pzzkI7_.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.EUjReaQE.js";const V=S({__name:"BatchConfirm",setup(S){var V="";const R=JSON.parse(e.getItem("userInfo")),L=t([]),q=t(0),E=t(0),H=t(0);t(0);k((e=>{V=e.deliveryID})),a((e=>{U(),s({success:e=>{const t=e.windowWidth;E.value=t-50}});const t=o();q.value=t.safeAreaInsets.bottom,H.value=q.value+20}));const U=()=>{let e={DeliveryID:V,HRCode:R.Account};l({title:"加载中..."}),A(e).then((e=>{n(),0==e.code&&(L.value=e.data[0])})).catch((e=>{n(),console.error("queryBatchList error:",e)}))};x((()=>{$().then((e=>{}))}));const $=()=>new Promise(((e,t)=>{let a="";for(let o=0;o<L.value.length;o++){let e=L.value[o];a+=e.Record_id+","+e.ProductInfoID+","+e.ProductInfoName+","+e.FactAmount+","+e.IsVoid+"^"}a=a.substring(0,a.length-1);let s={DeliveryID:V,Details:a,HRCode:R.Account};console.log("updateBatchList:",s),l({title:"加载中..."}),b(s).then((t=>{n(),e(t)})).catch((e=>{n(),console.error("updateBatchList error:",e),t(e)}))})),z=()=>{$().then((e=>{0==e.code&&new Promise(((e,t)=>{let a={DeliveryID:V,Status:"21",Remark:"",HRCode:R.Account};l({title:"加载中..."}),j(a).then((t=>{n(),e(t)})).catch((e=>{n(),console.error("queryBatchList error:",e),t(e)}))})).then((e=>{0==e.code&&(F(N.submitSuccessEvent,{}),I())}))}))};return(e,t)=>{const a=D,s=i,o=P(c("wd-input-number"),C),l=P(c("wd-swipe-action"),B),n=g;return d(),u(s,{class:"container"},{default:r((()=>[m(s,{class:"document-list"},{default:r((()=>[(d(!0),f(p,null,h(L.value,((t,n)=>(d(),u(s,{key:n,class:"document-item"},{default:r((()=>[m(l,null,{right:r((()=>[m(s,{style:{height:"100%"}},{default:r((()=>[m(s,{class:"delete-button",style:{background:"white",color:"red"},onClick:e=>{return a=t,void y({title:"",content:"确定要删除吗?",success:function(e){e.confirm?(a.IsVoid="1",$()):e.cancel}});var a}},{default:r((()=>[v(" 删除")])),_:2},1032,["onClick"])])),_:2},1024)])),default:r((()=>[m(s,{style:_({width:`${E.value}px`}),class:"document-details"},{default:r((()=>[m(s,{class:"right"},{default:r((()=>[m(s,{onClick:t=>e.toggleChecked(n)},{default:r((()=>[m(a,{class:"new-item"},{default:r((()=>[v("产品ID："+w(t.ProductInfoID),1)])),_:2},1024),m(a,{class:"new-item"},{default:r((()=>[v("产品名称："+w(t.ProductInfoName),1)])),_:2},1024),m(a,{class:"new-item"},{default:r((()=>[v("规格："+w(t.Specification),1)])),_:2},1024),m(a,{class:"new-item"},{default:r((()=>[v("批次号："+w(t.ProductBatch),1)])),_:2},1024),m(a,{class:"new-item"},{default:r((()=>[v("序列号："+w(t.SerialNumber),1)])),_:2},1024),m(a,{class:"new-item"},{default:r((()=>[v("领用单位："+w(t.UnitName),1)])),_:2},1024),m(a,{class:"new-item"},{default:r((()=>[v("效期："+w(t.ExpireDate),1)])),_:2},1024)])),_:2},1032,["onClick"]),m(s,{style:{display:"flex","text-align":"right"}},{default:r((()=>[m(o,{modelValue:t.FactAmount,"onUpdate:modelValue":e=>t.FactAmount=e,min:1,onChange:e=>(e=>{console.log("handleNumberChange:",e.FactAmount);let t=L.value.findIndex((t=>t.ProductInfoID===e.ProductInfoID));t>-1&&(L.value[t].FactAmount=e.FactAmount)})(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["style"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),m(s,{class:"footer"},{default:r((()=>[m(n,{style:_({height:`${H.value}px`}),onClick:z},{default:r((()=>[v("确定")])),_:1},8,["style"])])),_:1})])),_:1})}}},[["__scopeId","data-v-9e795f33"]]);export{V as default};
