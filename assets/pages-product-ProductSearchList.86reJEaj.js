import{r as e,S as a,o as t,N as l,x as o,y as s,z as u,g as n,h as c,q as d,d as r,k as m,c as i,A as f,F as h,n as p,m as v,s as _,Y as g,G as C,t as k,$ as y,v as A}from"./index-BHzFND5V.js";import{_ as I}from"./wd-search.DSfClmZp.js";import{o as P,j as w,k as x,r as N}from"./uni-app.es.wfT66NnM.js";import{_ as S}from"./wd-input-number.Cg3rLShK.js";import{e as j,E as D}from"./eventBus.4pzzkI7_.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.EUjReaQE.js";const b=V({__name:"ProductSearchList",setup(V){const b=e(""),U=e(""),E=JSON.parse(a.getItem("userInfo")),J=e(""),O=e(0),T=e([]);var q="",B=[];const F=e(0);P((e=>{console.log("options",e),b.value=e.deptCode,U.value=e.houseCode,q=e.sourceFrom,null==e.selectedProducts&&null==e.selectedProducts||(B=JSON.parse(e.selectedProducts))})),w((()=>{})),t((e=>{H();const a=l();O.value=a.safeAreaInsets.bottom,F.value=O.value+20}));const H=()=>{let e={DeptCode:b.value,StoreCode:U.value,SearchValue:J.value,HRCode:E.Account,UseType:"0",Distribution:"0"};o({title:"加载中..."}),x(e).then((e=>{s(),0==e.code&&(T.value=e.data[0],T.value.forEach((e=>{0==e.Amount&&(e.Amount=1),B.length>0&&B.map((a=>{e.ProductInfoID==a.ProductInfoID&&(e.checked=!0,e.Amount=a.Amount)}))})))})).catch((e=>{s(),console.error("queryList error:",e)}))},L=()=>{J.value="",H()},R=e=>{T.value[e].checked=!T.value[e].checked},$=()=>{console.log("搜索关键字:",J.value),H()},z=()=>{const e=T.value.filter((e=>e.checked));let a=!1;e.forEach((e=>{e.Amount<=0&&(a=!0)})),a?_({icon:"none",title:"申请数量不能为0"}):("home"==q?j(D.selectProductEventToHome,{data:JSON.stringify(e)}):"recentDetail"==q&&j(D.selectProductEventToRecentDetail,{data:JSON.stringify(e)}),g({delta:1}))};return(e,a)=>{const t=N(u("wd-search"),I),l=d,o=y,s=A,_=N(u("wd-input-number"),S),g=C;return r(),n(l,{class:"container"},{default:c((()=>[m(l,{class:"search-bar"},{default:c((()=>[m(t,{placeholder:"搜索产品",modelValue:J.value,"onUpdate:modelValue":a[0]||(a[0]=e=>J.value=e),"hide-cancel":"",onSearch:$,onClear:L,onBlur:$,maxlength:"100",style:{height:"40px"}},null,8,["modelValue"])])),_:1}),m(l,{class:"document-list"},{default:c((()=>[(r(!0),i(h,null,f(T.value,((e,a)=>(r(),n(l,{key:a,class:"document-item"},{default:c((()=>[m(l,{class:"document-details"},{default:c((()=>[m(o,{checked:e.checked,onClick:e=>R(a)},null,8,["checked","onClick"]),m(l,{class:"right"},{default:c((()=>[m(l,{onClick:e=>R(a)},{default:c((()=>[m(s,{class:"new-item"},{default:c((()=>[v("产品名称："+k(e.ProductName),1)])),_:2},1024),m(s,{class:"new-item"},{default:c((()=>[v("领用单位："+k(e.UseUnitName),1)])),_:2},1024),m(s,{class:"new-item"},{default:c((()=>[v("单价："+k(e.PurchasePrice),1)])),_:2},1024),m(s,{class:"new-item"},{default:c((()=>[v("供应商："+k(e.DefaultSupplierName),1)])),_:2},1024),m(s,{class:"new-item"},{default:c((()=>[v("类别代码："+k(e.CategoryCode),1)])),_:2},1024),m(s,{class:"new-item"},{default:c((()=>[v("类别名称："+k(e.CusCategoryName),1)])),_:2},1024)])),_:2},1032,["onClick"]),m(l,{style:{display:"flex","text-align":"right"}},{default:c((()=>[m(_,{modelValue:e.Amount,"onUpdate:modelValue":a=>e.Amount=a,min:1,onChange:a=>(e=>{console.log("handleNumberChange:",e.Amount);let a=T.value.findIndex((a=>a.ProductInfoID===e.ProductInfoID));a>-1&&(T.value[a].Amount=e.Amount)})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),m(l,{class:"footer"},{default:c((()=>[m(g,{style:p({height:`${F.value}px`}),onClick:z},{default:c((()=>[v("确定")])),_:1},8,["style"])])),_:1})])),_:1})}}},[["__scopeId","data-v-999f5eca"]]);export{b as default};
