import{r as e,o as t,s as l,v as a,x as o,f as s,g as n,A as u,p as d,b as c,j as r,l as i,t as f,c as p,y as m,F as g,W as y,q as _,S as D,D as h}from"./index-ocBV1Jcm.js";import{_ as C}from"./wd-input-number.BFQ05it0.js";import{S as v,o as I,e as b,r as w,s as P}from"./uni-app.es.HavBLUR1.js";import{_ as x}from"./wd-swipe-action.DUXxCn0l.js";import{n as A}from"./index.BeurTFNn.js";import{o as k,E as N,e as S}from"./eventBus.B4SEjQ6A.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.BMHP6ZQG.js";const U=j({setup(){var o="",s="",n="";const d=e("");let c=JSON.parse(v.getItem("userInfo"));const r=e([]),i=e([]);I((e=>{console.log("options",e),o=e.DeliveryID,s=e.DeptCode,n=e.StorehouseID,d.value=e.DeliveryCode})),t((async()=>{k(N.selectProductEventToRecentDetail,f),p(!1)}));const f=e=>{let t=JSON.parse(e.data);i.value=t},p=e=>{let t={DeliveryID:o,HRCode:c.Account};l({title:"加载中..."}),b(t).then((t=>{a(),0==t.code?(r.value=t.data[0],console.log("getRecentApplyDetail",t),e&&(S(N.recentEditSuccessEvent,{deliveryId:o}),y())):console.log("getRecentApplyDetail",t)})).catch((e=>{a(),console.log("getRecentApplyDetail error",e)}))};return{productList:r,newList:i,deliveryCode:d,handleNumberChange:e=>{console.log("handleNumberChange:",e.Amount);let t=i.value.findIndex((t=>t.ProductInfoID===e.ProductInfoID));t>-1&&(i.value[t].Amount=e.Amount)},handleDeleteClick:e=>{let t=i.value.findIndex((t=>t.ProductInfoID===e.ProductInfoID));t>-1&&i.value.splice(t,1)},addProduct:function(){A("/pages/product/ProductSearchList",{deptCode:s,houseCode:n,sourceFrom:"recentDetail",selectedProducts:JSON.stringify(i.value)})},saveForm:function(){let e="";for(let l=0;l<r.value.length;l++){let t=r.value[l];e+=t.ProductInfoID+","+t.ProductName+","+t.ApplyAmount+","+t.UseUnit+","+t.PurchasePrice+","+t.DefaultSupplierID+","+t.CustomCategoryID+","+t.CustomCategoryName+"^"}e=e.substring(0,e.length-1);let t="";for(let l=0;l<i.value.length;l++){let e=i.value[l];t+=e.ProductInfoID+","+e.ProductName+","+e.Amount+","+e.UseUnit+","+e.PurchasePrice+","+e.DefaultSupplierID+","+e.CategoryCode+","+e.CusCategoryName+"^"}t=t.substring(0,t.length-1),t.length>0&&(e=e+"^"+t);let d={DeliveryID:"",DeptCode:s,StorehouseID:n,UseTyp:"0",Details:e,HRCode:c.Account};console.log("saveDelivery:",d),l({title:"保存中..."}),P(d).then((e=>{a(),0==e.code&&(o=e.data[1][0].DeliveryID_out,p(!0),S(N.saveSuccessEvent,{})),u({icon:"none",title:e.msg})})).catch((e=>{console.error("saveDelivery error:",e),u({icon:"none",title:e.msg}),a()}))}}}},[["render",function(e,t,l,a,u,y){const v=_,I=d,b=w(o("wd-input-number"),C),P=w(o("wd-swipe-action"),x),A=D,k=h;return c(),s(I,{class:"container"},{default:n((()=>[r(v,{style:{padding:"10px"}},{default:n((()=>[i("单据号："+f(a.deliveryCode),1)])),_:1}),r(I,{style:{padding:"10px",color:"#000","font-weight":"bold","font-size":"18px"}},{default:n((()=>[r(I,null,{default:n((()=>[i("原单产品: ")])),_:1})])),_:1}),r(I,{class:"table"},{default:n((()=>[r(I,{class:"table-row header"},{default:n((()=>[r(I,{class:"table-cell"},{default:n((()=>[i("产品ID")])),_:1}),r(I,{class:"table-cell"},{default:n((()=>[i("产品名称")])),_:1}),r(I,{class:"table-cell"},{default:n((()=>[i("数量")])),_:1})])),_:1}),(c(!0),p(g,null,m(a.productList,(e=>(c(),s(I,{class:"table-row",key:e.id},{default:n((()=>[r(I,{class:"table-cell"},{default:n((()=>[i(f(e.ProductInfoID),1)])),_:2},1024),r(I,{class:"table-cell"},{default:n((()=>[i(f(e.ProductName),1)])),_:2},1024),r(I,{class:"table-cell"},{default:n((()=>[i(f(e.ApplyAmount),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),r(I,{style:{padding:"10px",color:"#000","font-weight":"bold","font-size":"18px"}},{default:n((()=>[r(I,null,{default:n((()=>[i("新增产品: ")])),_:1})])),_:1}),r(A,{class:"scrollable-list","scroll-y":""},{default:n((()=>[(c(!0),p(g,null,m(a.newList,(e=>(c(),s(I,{key:e.id},{default:n((()=>[r(P,null,{right:n((()=>[r(I,{style:{height:"100%"}},{default:n((()=>[r(I,{class:"delete-button",style:{background:"white",color:"red"},onClick:t=>a.handleDeleteClick(e)},{default:n((()=>[i(" 删除")])),_:2},1032,["onClick"])])),_:2},1024)])),default:n((()=>[r(I,{style:{"border-bottom":"1px solid #eee"}},{default:n((()=>[r(I,{class:"product-item"},{default:n((()=>[r(v,{class:"new-item"},{default:n((()=>[i("产品ID："+f(e.ProductInfoID),1)])),_:2},1024),r(v,{class:"new-item"},{default:n((()=>[i("产品名称："+f(e.ProductName),1)])),_:2},1024),r(v,{class:"new-item"},{default:n((()=>[i("申请数量："+f(e.Amount),1)])),_:2},1024),r(v,{class:"new-item"},{default:n((()=>[i("领用单位："+f(e.UseUnitName),1)])),_:2},1024),r(v,{class:"new-item"},{default:n((()=>[i("单价："+f(e.PurchasePrice),1)])),_:2},1024),r(v,{class:"new-item"},{default:n((()=>[i("供应商："+f(e.DefaultSupplierName),1)])),_:2},1024),r(v,{class:"new-item"},{default:n((()=>[i("类别代码："+f(e.CategoryCode),1)])),_:2},1024),r(v,{class:"new-item"},{default:n((()=>[i("类别名称："+f(e.CusCategoryName),1)])),_:2},1024)])),_:2},1024),r(I,{style:{display:"flex","justify-content":"flex-end","align-items":"center",padding:"0 10px 10px 0"}},{default:n((()=>[r(b,{modelValue:e.Amount,"onUpdate:modelValue":t=>e.Amount=t,min:1,onChange:t=>a.handleNumberChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),a.newList.length>0?(c(),s(I,{key:0,class:"button-group"},{default:n((()=>[r(k,{type:"button",style:{width:"40%"},onClick:a.addProduct},{default:n((()=>[i("添加产品")])),_:1},8,["onClick"]),r(k,{type:"button",style:{width:"40%"},onClick:a.saveForm},{default:n((()=>[i("保存")])),_:1},8,["onClick"])])),_:1})):(c(),s(I,{key:1,class:"button-group"},{default:n((()=>[r(k,{type:"button",style:{width:"95%"},onClick:a.addProduct},{default:n((()=>[i("添加产品")])),_:1},8,["onClick"])])),_:1}))])),_:1})}],["__scopeId","data-v-98073728"]]);export{U as default};
