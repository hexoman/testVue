import{r as e,S as a,o as t,M as l,s as o,v as s,x as u,f as n,g as c,p as d,b as r,j as i,c as m,y as f,F as h,n as p,l as v,A as _,X as g,E as C,t as k,_ as y,q as A}from"./index-DXU0MGIt.js";import{_ as I}from"./wd-search.CwhR_26z.js";import{o as P,h as w,i as x,r as S}from"./uni-app.es.BavDsfOz.js";import{_ as j}from"./wd-input-number.B7O37Ip-.js";import{e as D,E as N}from"./eventBus.D92icDni.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.DvcVfJo2.js";const b=V({__name:"ProductSearchList",setup(V){const b=e(""),E=e(""),U=JSON.parse(a.getItem("userInfo")),J=e(""),O=e(0),T=e([]);var q="",B=[];const F=e(0);P((e=>{console.log("options",e),b.value=e.deptCode,E.value=e.houseCode,q=e.sourceFrom,null==e.selectedProducts&&null==e.selectedProducts||(B=JSON.parse(e.selectedProducts))})),w((()=>{})),t((e=>{H();const a=l();O.value=a.safeAreaInsets.bottom,F.value=O.value+20}));const H=()=>{let e={DeptCode:b.value,StoreCode:E.value,SearchValue:J.value,HRCode:U.Account,UseType:"0",Distribution:"0"};o({title:"加载中..."}),x(e).then((e=>{s(),0==e.code&&(T.value=e.data[0],T.value.forEach((e=>{0==e.Amount&&(e.Amount=1),B.length>0&&B.map((a=>{e.ProductInfoID==a.ProductInfoID&&(e.checked=!0,e.Amount=a.Amount)}))})))})).catch((e=>{s(),console.error("queryList error:",e)}))},L=()=>{J.value="",H()},R=e=>{T.value[e].checked=!T.value[e].checked},M=()=>{console.log("搜索关键字:",J.value),H()},X=()=>{const e=T.value.filter((e=>e.checked));let a=!1;e.forEach((e=>{e.Amount<=0&&(a=!0)})),a?_({icon:"none",title:"申请数量不能为0"}):("home"==q?D(N.selectProductEventToHome,{data:JSON.stringify(e)}):"recentDetail"==q&&D(N.selectProductEventToRecentDetail,{data:JSON.stringify(e)}),g({delta:1}))};return(e,a)=>{const t=S(u("wd-search"),I),l=d,o=y,s=A,_=S(u("wd-input-number"),j),g=C;return r(),n(l,{class:"container"},{default:c((()=>[i(l,{class:"search-bar"},{default:c((()=>[i(t,{placeholder:"搜索产品",modelValue:J.value,"onUpdate:modelValue":a[0]||(a[0]=e=>J.value=e),"hide-cancel":"",onSearch:M,onClear:L,onBlur:M,maxlength:"100",style:{height:"40px"}},null,8,["modelValue"])])),_:1}),i(l,{class:"document-list"},{default:c((()=>[(r(!0),m(h,null,f(T.value,((e,a)=>(r(),n(l,{key:a,class:"document-item"},{default:c((()=>[i(l,{class:"document-details"},{default:c((()=>[i(o,{checked:e.checked,onClick:e=>R(a)},null,8,["checked","onClick"]),i(l,{class:"right"},{default:c((()=>[i(l,{onClick:e=>R(a)},{default:c((()=>[i(s,{class:"new-item"},{default:c((()=>[v("产品名称："+k(e.ProductName),1)])),_:2},1024),i(s,{class:"new-item"},{default:c((()=>[v("领用单位："+k(e.UseUnitName),1)])),_:2},1024),i(s,{class:"new-item"},{default:c((()=>[v("单价："+k(e.PurchasePrice),1)])),_:2},1024),i(s,{class:"new-item"},{default:c((()=>[v("供应商："+k(e.DefaultSupplierName),1)])),_:2},1024),i(s,{class:"new-item"},{default:c((()=>[v("类别代码："+k(e.CategoryCode),1)])),_:2},1024),i(s,{class:"new-item"},{default:c((()=>[v("类别名称："+k(e.CusCategoryName),1)])),_:2},1024)])),_:2},1032,["onClick"]),i(l,{style:{display:"flex","text-align":"right"}},{default:c((()=>[i(_,{modelValue:e.Amount,"onUpdate:modelValue":a=>e.Amount=a,min:1,onChange:a=>(e=>{console.log("handleNumberChange:",e.Amount);let a=T.value.findIndex((a=>a.ProductInfoID===e.ProductInfoID));a>-1&&(T.value[a].Amount=e.Amount)})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i(l,{class:"footer"},{default:c((()=>[i(g,{style:p({height:`${F.value}px`}),onClick:X},{default:c((()=>[v("确定")])),_:1},8,["style"])])),_:1})])),_:1})}}},[["__scopeId","data-v-999f5eca"]]);export{b as default};
