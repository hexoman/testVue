import{r as e,S as t,o as l,s as a,v as o,x as s,f as n,g as u,A as d,p as c,b as r,j as i,l as f,t as p,c as m,y as g,F as y,X as _,q as D,D as h,E as C}from"./index-9AxPtOFn.js";import{_ as v}from"./wd-input-number.4G6Nle8y.js";import{o as I,e as b,r as w,s as P}from"./uni-app.es.B-45xLGt.js";import{_ as x}from"./wd-swipe-action.nsFF_Hfa.js";import{n as A}from"./index.CWmNLb2R.js";import{o as k,E as N,e as S}from"./eventBus.D5u9CoqE.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CAl56Gk6.js";const U=j({setup(){var s="",n="",u="";const c=e("");let r=JSON.parse(t.getItem("userInfo"));const i=e([]),f=e([]);I((e=>{console.log("options",e),s=e.DeliveryID,n=e.DeptCode,u=e.StorehouseID,c.value=e.DeliveryCode})),l((async()=>{k(N.selectProductEventToRecentDetail,p),m(!1)}));const p=e=>{let t=JSON.parse(e.data);f.value=t},m=e=>{let t={DeliveryID:s,HRCode:r.Account};a({title:"加载中..."}),b(t).then((t=>{o(),0==t.code?(i.value=t.data[0],console.log("getRecentApplyDetail",t),e&&(S(N.recentEditSuccessEvent,{deliveryId:s}),_())):console.log("getRecentApplyDetail",t)})).catch((e=>{o(),console.log("getRecentApplyDetail error",e)}))};return{productList:i,newList:f,deliveryCode:c,handleNumberChange:e=>{console.log("handleNumberChange:",e.Amount);let t=f.value.findIndex((t=>t.ProductInfoID===e.ProductInfoID));t>-1&&(f.value[t].Amount=e.Amount)},handleDeleteClick:e=>{let t=f.value.findIndex((t=>t.ProductInfoID===e.ProductInfoID));t>-1&&f.value.splice(t,1)},addProduct:function(){A("/pages/product/ProductSearchList",{deptCode:n,houseCode:u,sourceFrom:"recentDetail",selectedProducts:JSON.stringify(f.value)})},saveForm:function(){let e="";for(let a=0;a<i.value.length;a++){let t=i.value[a];e+=t.ProductInfoID+","+t.ProductName+","+t.ApplyAmount+","+t.UseUnit+","+t.PurchasePrice+","+t.DefaultSupplierID+","+t.CustomCategoryID+","+t.CustomCategoryName+"^"}e=e.substring(0,e.length-1);let t="";for(let a=0;a<f.value.length;a++){let e=f.value[a];t+=e.ProductInfoID+","+e.ProductName+","+e.Amount+","+e.UseUnit+","+e.PurchasePrice+","+e.DefaultSupplierID+","+e.CategoryCode+","+e.CusCategoryName+"^"}t=t.substring(0,t.length-1),t.length>0&&(e=e+"^"+t);let l={DeliveryID:"",DeptCode:n,StorehouseID:u,UseTyp:"0",Details:e,HRCode:r.Account};console.log("saveDelivery:",l),a({title:"保存中..."}),P(l).then((e=>{o(),0==e.code&&(s=e.data[1][0].DeliveryID_out,m(!0),S(N.saveSuccessEvent,{})),d({icon:"none",title:e.msg})})).catch((e=>{console.error("saveDelivery error:",e),d({icon:"none",title:e.msg}),o()}))}}}},[["render",function(e,t,l,a,o,d){const _=D,I=c,b=w(s("wd-input-number"),v),P=w(s("wd-swipe-action"),x),A=h,k=C;return r(),n(I,{class:"container"},{default:u((()=>[i(_,{style:{padding:"10px"}},{default:u((()=>[f("单据号："+p(a.deliveryCode),1)])),_:1}),i(I,{style:{padding:"10px",color:"#000","font-weight":"bold","font-size":"18px"}},{default:u((()=>[i(I,null,{default:u((()=>[f("原单产品: ")])),_:1})])),_:1}),i(I,{class:"table"},{default:u((()=>[i(I,{class:"table-row header"},{default:u((()=>[i(I,{class:"table-cell"},{default:u((()=>[f("产品ID")])),_:1}),i(I,{class:"table-cell"},{default:u((()=>[f("产品名称")])),_:1}),i(I,{class:"table-cell"},{default:u((()=>[f("数量")])),_:1})])),_:1}),(r(!0),m(y,null,g(a.productList,(e=>(r(),n(I,{class:"table-row",key:e.id},{default:u((()=>[i(I,{class:"table-cell"},{default:u((()=>[f(p(e.ProductInfoID),1)])),_:2},1024),i(I,{class:"table-cell"},{default:u((()=>[f(p(e.ProductName),1)])),_:2},1024),i(I,{class:"table-cell"},{default:u((()=>[f(p(e.ApplyAmount),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i(I,{style:{padding:"10px",color:"#000","font-weight":"bold","font-size":"18px"}},{default:u((()=>[i(I,null,{default:u((()=>[f("新增产品: ")])),_:1})])),_:1}),i(A,{class:"scrollable-list","scroll-y":""},{default:u((()=>[(r(!0),m(y,null,g(a.newList,(e=>(r(),n(I,{key:e.id},{default:u((()=>[i(P,null,{right:u((()=>[i(I,{style:{height:"100%"}},{default:u((()=>[i(I,{class:"delete-button",style:{background:"white",color:"red"},onClick:t=>a.handleDeleteClick(e)},{default:u((()=>[f(" 删除")])),_:2},1032,["onClick"])])),_:2},1024)])),default:u((()=>[i(I,{style:{"border-bottom":"1px solid #eee"}},{default:u((()=>[i(I,{class:"product-item"},{default:u((()=>[i(_,{class:"new-item"},{default:u((()=>[f("产品ID："+p(e.ProductInfoID),1)])),_:2},1024),i(_,{class:"new-item"},{default:u((()=>[f("产品名称："+p(e.ProductName),1)])),_:2},1024),i(_,{class:"new-item"},{default:u((()=>[f("申请数量："+p(e.Amount),1)])),_:2},1024),i(_,{class:"new-item"},{default:u((()=>[f("领用单位："+p(e.UseUnitName),1)])),_:2},1024),i(_,{class:"new-item"},{default:u((()=>[f("单价："+p(e.PurchasePrice),1)])),_:2},1024),i(_,{class:"new-item"},{default:u((()=>[f("供应商："+p(e.DefaultSupplierName),1)])),_:2},1024),i(_,{class:"new-item"},{default:u((()=>[f("类别代码："+p(e.CategoryCode),1)])),_:2},1024),i(_,{class:"new-item"},{default:u((()=>[f("类别名称："+p(e.CusCategoryName),1)])),_:2},1024)])),_:2},1024),i(I,{style:{display:"flex","justify-content":"flex-end","align-items":"center",padding:"0 10px 10px 0"}},{default:u((()=>[i(b,{modelValue:e.Amount,"onUpdate:modelValue":t=>e.Amount=t,min:1,onChange:t=>a.handleNumberChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),a.newList.length>0?(r(),n(I,{key:0,class:"button-group"},{default:u((()=>[i(k,{type:"button",style:{width:"40%"},onClick:a.addProduct},{default:u((()=>[f("添加产品")])),_:1},8,["onClick"]),i(k,{type:"button",style:{width:"40%"},onClick:a.saveForm},{default:u((()=>[f("保存")])),_:1},8,["onClick"])])),_:1})):(r(),n(I,{key:1,class:"button-group"},{default:u((()=>[i(k,{type:"button",style:{width:"95%"},onClick:a.addProduct},{default:u((()=>[f("添加产品")])),_:1},8,["onClick"])])),_:1}))])),_:1})}],["__scopeId","data-v-98073728"]]);export{U as default};
