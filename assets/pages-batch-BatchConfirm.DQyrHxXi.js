import{r as e,o as t,V as a,L as s,s as o,v as l,x as n,f as c,g as u,p as r,b as i,j as d,c as m,y as f,F as h,n as p,l as _,W as v,D as I,t as g,X as w,q as y}from"./index-ocBV1Jcm.js";import{_ as D}from"./wd-input-number.BFQ05it0.js";import{S as C,o as b,b as k,c as x,u as A,r as j,d as P}from"./uni-app.es.HavBLUR1.js";import{_ as B}from"./wd-swipe-action.DUXxCn0l.js";import{e as F,E as V}from"./eventBus.B4SEjQ6A.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.BMHP6ZQG.js";const S=N({__name:"BatchConfirm",setup(N){var S="";const L=JSON.parse(C.getItem("userInfo")),R=e([]),q=e(0),E=e(0),H=e(0);e(0);b((e=>{S=e.deliveryID})),t((e=>{U(),a({success:e=>{const t=e.windowWidth;E.value=t-50}});const t=s();q.value=t.safeAreaInsets.bottom,H.value=q.value+20}));const U=()=>{let e={DeliveryID:S,HRCode:L.Account};o({title:"加载中..."}),k(e).then((e=>{l(),0==e.code&&(R.value=e.data[0])})).catch((e=>{l(),console.error("queryBatchList error:",e)}))};x((()=>{W().then((e=>{}))}));const W=()=>new Promise(((e,t)=>{let a="";for(let o=0;o<R.value.length;o++){let e=R.value[o];a+=e.Record_id+","+e.ProductInfoID+","+e.ProductInfoName+","+e.FactAmount+","+e.IsVoid+"^"}a=a.substring(0,a.length-1);let s={DeliveryID:S,Details:a,HRCode:L.Account};console.log("updateBatchList:",s),o({title:"加载中..."}),A(s).then((t=>{l(),e(t)})).catch((e=>{l(),console.error("updateBatchList error:",e),t(e)}))})),$=()=>{W().then((e=>{0==e.code&&new Promise(((e,t)=>{let a={DeliveryID:S,Status:"21",Remark:"",HRCode:L.Account};o({title:"加载中..."}),P(a).then((t=>{l(),e(t)})).catch((e=>{l(),console.error("queryBatchList error:",e),t(e)}))})).then((e=>{0==e.code&&(F(V.submitSuccessEvent,{}),v())}))}))};return(e,t)=>{const a=y,s=r,o=j(n("wd-input-number"),D),l=j(n("wd-swipe-action"),B),v=I;return i(),c(s,{class:"container"},{default:u((()=>[d(s,{class:"document-list"},{default:u((()=>[(i(!0),m(h,null,f(R.value,((t,n)=>(i(),c(s,{key:n,class:"document-item"},{default:u((()=>[d(l,null,{right:u((()=>[d(s,{style:{height:"100%"}},{default:u((()=>[d(s,{class:"delete-button",style:{background:"white",color:"red"},onClick:e=>{return a=t,void w({title:"",content:"确定要删除吗?",success:function(e){e.confirm?(a.IsVoid="1",W()):e.cancel}});var a}},{default:u((()=>[_(" 删除")])),_:2},1032,["onClick"])])),_:2},1024)])),default:u((()=>[d(s,{style:p({width:`${E.value}px`}),class:"document-details"},{default:u((()=>[d(s,{class:"right"},{default:u((()=>[d(s,{onClick:t=>e.toggleChecked(n)},{default:u((()=>[d(a,{class:"new-item"},{default:u((()=>[_("产品ID："+g(t.ProductInfoID),1)])),_:2},1024),d(a,{class:"new-item"},{default:u((()=>[_("产品名称："+g(t.ProductInfoName),1)])),_:2},1024),d(a,{class:"new-item"},{default:u((()=>[_("规格："+g(t.Specification),1)])),_:2},1024),d(a,{class:"new-item"},{default:u((()=>[_("批次号："+g(t.ProductBatch),1)])),_:2},1024),d(a,{class:"new-item"},{default:u((()=>[_("序列号："+g(t.SerialNumber),1)])),_:2},1024),d(a,{class:"new-item"},{default:u((()=>[_("领用单位："+g(t.UnitName),1)])),_:2},1024),d(a,{class:"new-item"},{default:u((()=>[_("效期："+g(t.ExpireDate),1)])),_:2},1024)])),_:2},1032,["onClick"]),d(s,{style:{display:"flex","text-align":"right"}},{default:u((()=>[d(o,{modelValue:t.FactAmount,"onUpdate:modelValue":e=>t.FactAmount=e,min:1,onChange:e=>(e=>{console.log("handleNumberChange:",e.FactAmount);let t=R.value.findIndex((t=>t.ProductInfoID===e.ProductInfoID));t>-1&&(R.value[t].FactAmount=e.FactAmount)})(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["style"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),d(s,{class:"footer"},{default:u((()=>[d(v,{style:p({height:`${H.value}px`}),onClick:$},{default:u((()=>[_("确定")])),_:1},8,["style"])])),_:1})])),_:1})}}},[["__scopeId","data-v-9e795f33"]]);export{S as default};
